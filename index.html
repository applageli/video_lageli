<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="SHORTCUT ICON" href="img/L2.png">
    <title>Encontre o amor Lageli</title>
    <link rel="stylesheet" type="text/css" href="css/lit.css">
    <link rel="stylesheet" type="text/css" href="css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
</head>
<body>
  
  <div class="c" style="position: fixed;width: 100%;background: #0e0c0d;top: 0px;left: 0px;margin: 0;padding: 0;max-width: 100%;box-shadow: 0 2px 4px -1px rgba(0,0,0,.2), 0 4px 5px 0 rgba(0,0,0,.14), 0 1px 10px 0 rgba(0,0,0,.12);">

    <div class="row" style="margin: 0;padding: 0;">
      <div class="1 col" style="margin: 0;padding: 0;">
        <button id="botaoVoltar" class="btn primary" style="cursor: pointer;display: none;" onclick="voltar()">VOLTAR</button>
      </div>  
      <div class="5 col" style="margin: 0;padding: 0;">
        <img src="img/logo.png" width="150" style="position: absolute;top: -4px" />
        <span id="recebeTextoJogo">Para jogar clique em um quadrado do quadro abaixo e veja se encontra o <span style="color:#ff5b56;">❤</span> escondido!</span>
      </div>
      <div align="right" class="6 col" style="margin: 0;padding: 0;display: table-cell; vertical-align: middle;">
        <span class="esconder" style="display: none">
          <span id="escondeisso" style="font-family:Product Sans;display: none;color:#f1f1f0;">Bem vindo! <span id="botaoSairNome"></span>, </span> <a id="botaoSair" href="javascript: delete localStorage.dados;location.reload()" style="display: none;">sair</a>&nbsp;&nbsp;&nbsp;&nbsp;
          <button onclick="exportar()" class="btn primary">download .zip</button>
        </span>
      </div>
    </div>

  </div>  
  
  <div id="telaLogin" class="c">
    <br><br>
    <div align="left" class="row">
      <div align="left" class="5 col"></div>
      <div align="left" class="2 col">
        <input type="text" id="txtusuario" placeholder="Usuário do Agely" style="border-radius: 20px;border: none;padding-top: 4px;font-family: Product Sans;font-size: 20px;padding-bottom: 4px;padding-left: 10px;outline: none;" autofocus />
      </div>
      <div align="left" class="5 col"></div>
    </div>

    <div align="left" class="row">
      <div align="left" class="5 col"></div>
      <div align="left" class="2 col">
        <input type="password" id="txtsenha" placeholder="Senha" style="border-radius: 20px;border: none;padding-top: 4px;font-family: Product Sans;font-size: 20px;padding-bottom: 4px;padding-left: 10px;outline: none;" />
      </div>
      <div align="left" class="5 col"></div>
    </div>

    <div align="left" class="row">
      <div align="left" class="5 col"></div>
      <div align="left" class="2 col">
        <button id="btnEntrar" class="btn primary" style="width: 100%;outline: none;cursor: pointer;">entrar</button>
      </div>
      <div align="left" class="5 col"></div>
    </div>

  </div>

  <div id="telaCadastro" class="c" style="display: none; margin: 0">

    <!-- <div class="row" style="background: #f1f1f0;color: #000;">
      <div class="12 col"> -->
        <br><br>
        <h2>Cadastro</h2>
        <p>Cadastre as fotos ou videos que aparecerão no jogo para cada uma de suas consultoras.</p>
                <!-- 
        <div class="row">
          dasdsadasd
          <div class="12 col">    -->
            <!-- <select id="selectConsultorasCadastro" style="font-family: Product Sans"></select> -->
            <input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" class="w-100" placeholder="pesquisar pelo nome da consultora" id="txtPesquisar" style="font-family: Product Sans" />
            <p style="position: relative;
    bottom: 18px;
    font-size: 14px;
    COLOR: darkgray;z-index: -1">pressione enter para pesquisar</p>
            <input type="file" id="arquivoMidia" style="visibility: hidden;">
          <!-- </div>
        </div> -->

        <div id="divTabelaMidias" style="overflow-y: auto;height: 330px;background: white;">
          <table id="tabelaMidias" class="w-100">
            <tbody></tbody>
          </table>
        </div>  

     <!--  </div>
    </div> -->

  </div>

  <div id="segundaTela" class="c" style="display: none;">
    
    <br><br>
    
    <div class="row">
      <div class="12 col">
        <p id="textoJogo"></p>
      </div>
    </div>
    
    <div class="row">
      <div class="1 col">        
        <!-- <button class="btn primary" id="btn-start-recording">Jogar</button> -->
      </div>
      <div class="3 col">        
        <button class="btn primary" id="btn-stop-recording" disabled style="display: none">Salvar Jogo</button>
      </div>
      <div class="8 col"></div>        
    </div>
    
    <div align="center" class="row">
      <div id="recebeTotal" align="left" class="12 col">Tentativas: 0</div>
    </div>

    <div id="div_jogo" align="center" class="row">
      <div id="div_jogo_inner" class="12 col">
        
        <div class="row" style="border-spacing: 0;margin: 0;background: #f1f1f0">
          <div align="center" class="1 col"></div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">A</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">B</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">C</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">D</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">E</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">F</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">G</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">H</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">I</div>
          <div align="center" class="1 col" style="width: 24px;height: 20px;">J</div>
          <div align="center" class="1 col"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">1</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">2</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">3</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">4</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">5</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">6</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">7</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">8</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">9</div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

        <div class="row" style="border-spacing: 0;margin: 0;">
          <div align="center" class="1 col" style="height: 20px;background: #f1f1f0">10 </div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col quadradoClicavel" style="width: 24px;height: 48px;border:1px solid #971717;"></div>
          <div align="center" class="1 col" style="background: #f1f1f0"></div>
        </div>

      </div>
    </div>

    <div id="div_fotos" class="swiper-container" style="display: none;">
      <div class="swiper-wrapper"></div>
    </div>

  </div>

  <video controls autoplay></video>
  
  <audio id="musica">
    <source src="media/lageli.ogg" type="audio/ogg">
    <source src="media/lageli.mp3" type="audio/mpeg">
  </audio>

  <audio id="selecionou">
    <source src="media/selecionou.ogg" type="audio/ogg">
    <source src="media/selecionou.mp3" type="audio/mpeg">
  </audio>

  <script src="js/jquery.js"></script>
  <script src="js/db.js"></script>
  <script src="js/RecordRTC.js"></script>
  <script src="js/FileSaver.js"></script>
  <script src="js/jszip.min.js"></script>
  <script src="js/swiper.min.js"></script>
  <script src="js/adapter-latest.js"></script>
  <script src="js/dados.js"></script>
  <script>

    var mySwiper;
    var dados;
    var arrayEmoji = ['👏','😔','☠','🎪','🤦','🏻','♂','🌿','😇','😶','👣','👻','🌭','🙃','🎈','👀','😡','😱','🏻','👩','🏻','🔧','🌂','👠','🎩','🐏','🦍','🌏','🌟','🌈','🔥','🍵','🍭','🎾','🥅','🚲','🚆','🚂','💻','🕰','📓','🔏','🈷','🏖','🚧'];
    var boolPlay = false;
    var musica = document.getElementById("musica"); 
    var selecionou = document.getElementById("selecionou"); 
    var boolCadastro = false;
    var telaAtual = 'login';

    function jogar(id) {

      $('#botaoVoltar').show();
      telaAtual = 'jogo';
      idpessoaSelecionado = id;
      contaX = 0;

      var linhas = '';

      linhas += '<div class="swiper-slide">';
      var tipoMidia1 = retornaMidias(id, 1).split(';')[0].split('/')[1];

      if ((tipoMidia1 == 'jpg')||(tipoMidia1 == 'jpeg')||(tipoMidia1 == 'png')||(tipoMidia1 == 'gif')) {

        linhas += '<img src="'+retornaMidias(id, 1)+'" width="200" />';
      } else {

        linhas += '<video src="'+retornaMidias(id, 1)+'" style="display:inherit;position: inherit;" muted autoplay loop></video>';
      }
      linhas += '</div>';

      linhas += '<div class="swiper-slide">';
      var tipoMidia2 = retornaMidias(id, 2).split(';')[0].split('/')[1];

      if ((tipoMidia2 == 'jpg')||(tipoMidia2 == 'jpeg')||(tipoMidia2 == 'png')||(tipoMidia2 == 'gif')) {

        linhas += '<img src="'+retornaMidias(id, 2)+'" width="200" />';
      } else {

        linhas += '<video src="'+retornaMidias(id, 2)+'" style="display:inherit;position: inherit;" muted autoplay loop></video>';
      }
      linhas += '</div>';

      linhas += '<div class="swiper-slide">';
      var tipoMidia3 = retornaMidias(id, 3).split(';')[0].split('/')[1];

      if ((tipoMidia3 == 'jpg')||(tipoMidia3 == 'jpeg')||(tipoMidia3 == 'png')||(tipoMidia3 == 'gif')) {

        linhas += '<img src="'+retornaMidias(id, 3)+'" width="200" />';
      } else {

        linhas += '<video src="'+retornaMidias(id, 3)+'" style="display:inherit;position: inherit;" muted autoplay loop></video>';
      }
      linhas += '</div>';


      $('#div_fotos').find('div').html(linhas);

      $('#telaCadastro').hide();
      $('#segundaTela').show();
      $('#div_jogo').show();
      $('#div_fotos').hide();
      $('.quadradoClicavel').html('');

      boolPlay = true;
      this.disabled = true;
      captureCamera(function(camera) {
        setSrcObject(camera, video);
        video.play();

        recorder = RecordRTC(camera, {
            type: 'video',
            mimeType: 'audio/wav'
        });

        recorder.startRecording();

        // release camera on stopRecording
        recorder.camera = camera;

        document.getElementById('btn-stop-recording').disabled = false;
      });
    }

    var arrayMidias = [];

    function salvaMidia(str_imagem) {

      ldb.get('arrayDados', function(value) {

        var auxArrayDados = JSON.parse(value);

        var objAuxArrayDados = {};
        objAuxArrayDados[dados.idempresa+'_'+idpessoaSelecionado+'_'+posicaoSelecionado] = str_imagem;

        if (auxArrayDados === null) {
          auxArrayDados = [];
        }

        auxArrayDados.push(objAuxArrayDados);
        
        if (typeof retornaMidias(idpessoaSelecionado, posicaoSelecionado) == 'undefined') {

          ldb.set('arrayDados', JSON.stringify(auxArrayDados));
          dados.arrayDados = auxArrayDados;
        } else {

          var arrayDados = dados.arrayDados;
          for (var i in arrayDados) {
            var e = arrayDados[i];

            if (typeof e[dados.idempresa+'_'+idpessoaSelecionado+'_'+posicaoSelecionado] != 'undefined') {
              e[dados.idempresa+'_'+idpessoaSelecionado+'_'+posicaoSelecionado] = str_imagem;
            }
          }

          ldb.set('arrayDados', JSON.stringify(arrayDados));
          dados.arrayDados = arrayDados;
        }
        
        boolCadastro = true;
        preencheTabela();
      });
    }

    $('#txtPesquisar').keypress(function(e) {
      if (event.keyCode == 13) {
        boolCadastro = false;
        preencheTabela();
      }
    });

    function retornaMidias(idpessoa, posicao) {
      
      var arrayDados = dados.arrayDados, src;
      
      for (var x in arrayDados) {
        var t = arrayDados[x];

        if (typeof t[dados.idempresa+'_'+idpessoa+'_'+posicao] != 'undefined') {
          src = t[dados.idempresa+'_'+idpessoa+'_'+posicao];
        }
      }

      return src;
    }

    function preencheTabela() {
      var linhas = '';

      for (var i in arrayPessoas) {

        var totalUploads = 0;
        var e = arrayPessoas[i];
        var tipoMidiaAumentar = 1;

        var boolPesquisar = e.nome.toUpperCase().normalize('NFD').replace(/[\u0300-\u036f]/g, "").indexOf( $('#txtPesquisar').val().toUpperCase().normalize('NFD').replace(/[\u0300-\u036f]/g, "") );

        if ((e.idempresa == dados.idempresa)&&(boolPesquisar >= 0)) {

          linhas += '<tr>';
            linhas += '<td>';
              linhas += e.nome;
            linhas += '</td>';

            linhas += '<td>';
              linhas += '<div onclick="sobeFoto('+e.idpessoa+', 1)" style="border: 1px solid;display: flex;align-items: center;border-radius: 10px;padding-left: 15px;padding-right: 15px;user-select: none;cursor: pointer;">';
                linhas += '<div align="center" style="flex: 1;">';
                  
                  if (typeof retornaMidias(e.idpessoa, 1) == 'undefined') {

                    linhas += '<img src="img/mais.svg" />';
                    linhas += '<div align="center" style="flex: 1;margin:0;">ADICIONAR</div>';

                  } else {
                    totalUploads++;

                    var tipoMidia = retornaMidias(e.idpessoa, 1).split(';')[0].split('/')[1];

                    if ((tipoMidia == 'jpg')||(tipoMidia == 'jpeg')||(tipoMidia == 'png')||(tipoMidia == 'gif')) {

                      linhas += '<img src="'+retornaMidias(e.idpessoa, 1)+'" height="60px" />';
                    } else {

                      linhas += '<video src="'+retornaMidias(e.idpessoa, 1)+'" style="display:inherit;position: inherit;height:60px;width: inherit;" autoplay muted loop></video>';
                      tipoMidiaAumentar = 2;
                    }
                  }
                
                linhas += '</div>';
              linhas += '</div>';
                
              if (typeof retornaMidias(e.idpessoa, 1) != 'undefined') {
                linhas += '<a onclick="aumentar('+e.idpessoa+', 1, '+tipoMidiaAumentar+')" style="cursor:pointer;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUMENTAR</a>';
              } else {
                linhas += '<a></a>';
              }  
            
            linhas += '</td>';
            linhas += '<td>';
              linhas += '<div onclick="sobeFoto('+e.idpessoa+', 2)" style="border: 1px solid;display: flex;align-items: center;border-radius: 10px;padding-left: 15px;padding-right: 15px;user-select: none;cursor: pointer;">';
                linhas += '<div align="center" style="flex: 1;">';
                  
                  if (typeof retornaMidias(e.idpessoa, 2) == 'undefined') {

                    linhas += '<img src="img/mais.svg" />';
                    linhas += '<div align="center" style="flex: 1;margin:0;">ADICIONAR</div>';

                  } else {
                    totalUploads++;

                    var tipoMidia = retornaMidias(e.idpessoa, 2).split(';')[0].split('/')[1];

                    if ((tipoMidia == 'jpg')||(tipoMidia == 'jpeg')||(tipoMidia == 'png')||(tipoMidia == 'gif')) {

                      linhas += '<img src="'+retornaMidias(e.idpessoa, 2)+'" height="60px" />';
                    } else {

                      linhas += '<video src="'+retornaMidias(e.idpessoa, 2)+'" style="display:inherit;position: inherit;height:60px;width: inherit;" autoplay muted loop></video>';
                      tipoMidiaAumentar = 2;
                    }
                  }
                  
                linhas += '</div>';
              linhas += '</div>';

              if (typeof retornaMidias(e.idpessoa, 2) != 'undefined') {
                linhas += '<a onclick="aumentar('+e.idpessoa+', 2, '+tipoMidiaAumentar+')" style="cursor:pointer;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUMENTAR</a>';
              } else {
                linhas += '<a></a>';
              } 

            linhas += '</td>';
            linhas += '<td>';
              linhas += '<div onclick="sobeFoto('+e.idpessoa+', 3)" style="border: 1px solid;display: flex;align-items: center;border-radius: 10px;padding-left: 15px;padding-right: 15px;user-select: none;cursor: pointer;">';
                linhas += '<div align="center" style="flex: 1;">';
                  
                  if (typeof retornaMidias(e.idpessoa, 3) == 'undefined') {

                    linhas += '<img src="img/mais.svg" />';
                    linhas += '<div align="center" style="flex: 1;margin:0;">ADICIONAR</div>';

                  } else {
                    totalUploads++;

                    var tipoMidia = retornaMidias(e.idpessoa, 3).split(';')[0].split('/')[1];

                    if ((tipoMidia == 'jpg')||(tipoMidia == 'jpeg')||(tipoMidia == 'png')||(tipoMidia == 'gif')) {

                      linhas += '<img src="'+retornaMidias(e.idpessoa, 3)+'" height="60px" />';
                    } else {

                      linhas += '<video src="'+retornaMidias(e.idpessoa, 3)+'" style="width: inherit;height:60px;display:inherit;position: inherit;" autoplay muted loop></video>';
                      tipoMidiaAumentar = 2;
                    }
                  } 

                linhas += '</div>';
              linhas += '</div>';

              if (typeof retornaMidias(e.idpessoa, 3) != 'undefined') {
                linhas += '<a onclick="aumentar('+e.idpessoa+', 3, '+tipoMidiaAumentar+')" style="cursor:pointer;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AUMENTAR</a>';
              } else {
                linhas += '<a></a>';
              } 

            linhas += '</td>';
            
            if (typeof retornaMidias(e.idpessoa, 4) == 'undefined') {

              linhas += '<td></td>';

            } else {
              linhas += '<td><video src="data:video/webm;base64,'+retornaMidias(e.idpessoa, 4)+'" style="width: inherit;display:inherit;position: inherit;height:60px;" autoplay muted loop></video>';
              if (typeof retornaMidias(e.idpessoa, 3) != 'undefined') {
                linhas += '<a onclick="aumentar('+e.idpessoa+', 4, 3)" style="cursor:pointer;">AUMENTAR</a>';
              } else {
                linhas += '<a></a>';
              }
              linhas += '</td>';
            }
            
            if (totalUploads == 3) {

              linhas += '<td>';

              linhas += '<button onclick="jogar('+e.idpessoa+');" class="btn primary">jogar!</button></td>';
            } else {
              linhas += '<td></td>';
            }

          
          linhas += '</tr>';
        }
      }

      $('#tabelaMidias tbody').html(linhas);
      $('#arquivoMidia').val('');

      if (boolCadastro === false) {

        $("#divTabelaMidias").animate({ scrollTop: 0 }, "fast");
      }

      boolCadastro = false;
    }

    function numeroRandomico(maximum, minimum) {
      return Math.floor(Math.random() * (maximum - minimum + 1)) + minimum;
    }
    
    $(function() {
      
      if (typeof localStorage.dados != 'undefined') {
        
        dados = JSON.parse(localStorage.dados);
        $('#telaLogin').hide();
        $('#telaCadastro').show();
        $('#botaoSair').show();
        if ($(window).width() >= 600) {

          $('#escondeisso').show();
        }
        $('#botaoSairNome').html(dados.usuario);

        var linhas = '';

        var arrayConsultoras = $.grep(arrayPessoas, function(e){ return e.idempresa == dados.idempresa });

        linhas += '<option value="">Selecione a consultora:</option>';
        for (var i in arrayConsultoras) {
          var e = arrayConsultoras[i];

          linhas += '<option value="'+e.idpessoa+'">'+e.nome+'</option>';
        }

        $('#selectConsultoras').html(linhas);
        $('#selectConsultorasCadastro').html(linhas);
        telaAtual = 'cadastro';
        ldb.get('arrayDados', function(value) {

          var auxArrayDados = JSON.parse(value);

          if (auxArrayDados === null) {
            auxArrayDados = [];
          }
          
          dados.arrayDados = auxArrayDados;
          preencheTabela();
        });
         
      } else {

        $('#botaoVoltar').hide();    
      }
    });

    var video = document.querySelector('video');

    function captureCamera(callback) {
      navigator.mediaDevices.getUserMedia({ audio: false, video: true }).then(function(camera) {
        callback(camera);
      }).catch(function(error) {
        alert('Unable to capture your camera. Please check console logs.');
        console.error(error);
      });
    }

    var blobToBase64 = function(blob, cb) {
      var reader = new FileReader();
      reader.onload = function() {
      var dataUrl = reader.result;
      var base64 = dataUrl.split(',')[1];
      cb(base64);
      };
      reader.readAsDataURL(blob);
    };

    function stopRecordingCallback() {
      video.src = video.srcObject = null;
      video.src = URL.createObjectURL(recorder.getBlob());
      video.play();
      recorder.camera.stop();
      
      var _blob = recorder.getBlob();

      blobToBase64(_blob,function(b) {
        ldb.get('arrayDados', function(value) {

          var auxArrayDados = JSON.parse(value);

          var objAuxArrayDados = {};
          objAuxArrayDados[dados.idempresa+'_'+idpessoaSelecionado+'_4'] = b;

          if (auxArrayDados === null) {
            auxArrayDados = [];
          }
          auxArrayDados.push(objAuxArrayDados);
          
          if (typeof retornaMidias(idpessoaSelecionado, 4) == 'undefined') {

            ldb.set('arrayDados', JSON.stringify(auxArrayDados));
            dados.arrayDados = auxArrayDados;
          } else {

            var arrayDados = dados.arrayDados;
            for (var i in arrayDados) {
              var e = arrayDados[i];

              if (typeof e[dados.idempresa+'_'+idpessoaSelecionado+'_4'] != 'undefined') {
                e[dados.idempresa+'_'+idpessoaSelecionado+'_4'] = b;
              }
            }
            ldb.set('arrayDados', JSON.stringify(arrayDados));
            dados.arrayDados = arrayDados;
          }

          preencheTabela();
        });

      });

      // recorder.destroy();
      // recorder = null;
    }

    var recorder; // globally accessible

    document.getElementById('btn-stop-recording').onclick = function() {
      
      // $('video').show();
      boolPlay = false;
      this.disabled = true;
      recorder.stopRecording(stopRecordingCallback);

      alert('jogo salvo!');
      $('#telaCadastro').show();
      $('#div_fotos').hide();
      $('#segundaTela').hide();
      musica.pause();
      musica.currentTime = 0;
      boolCadastro = true;
      $('#recebeTotal').show();
      $('#textoJogo').html('Para jogar clique em um quadrado do quadro abaixo e veja se encontra o <span style="color:#ff5b56;">❤</span> escondido!');
      $('#btn-stop-recording').hide();
      $('#recebeTotal').html('Tentativas: 0');
      $('#div_fotos').find('div').html('');
    };

    var contaX = 0;
    $('.quadradoClicavel').click(function() {
      
      if (boolPlay === true) {

        if (contaX <= 19) {

          if ($(this).html().length == 0) {

            selecionou.pause();
            selecionou.play();
            $(this).html( arrayEmoji[ numeroRandomico(0,45) ] );
          }
        }

        contaX = 0;
        $('.quadradoClicavel').each(function() {
          if ($(this).html().length > 0) {

            contaX++;
          }
        });

        $('#recebeTotal').html('Tentativas: '+(contaX).toString());

        if (contaX === 20) {
          
          setTimeout(function() {

            telaAtual = 'slide';
            $('#div_jogo').hide();
            $('#div_fotos').show(); 
            $('#recebeTotal').hide();
            $('#textoJogo').html('Você não econtrou o <span style="color:#ff5b56;">❤</span> Lageli, mas você já tinha ele!');
            $('#btn-start-recording').hide();
            $('#btn-stop-recording').show();
            
            musica.play();
            if (typeof mySwiper != 'undefined') {

              mySwiper.destroy();
            }
            mySwiper = new Swiper ('.swiper-container', {
              centeredSlides: true
              ,
              autoplay: {
                delay: 2500,
                disableOnInteraction: false,
              },
              loop: true,
              // effect: 'flip' //fade, cube, coverflow, flip
            });
          },3600);
        }
      }
    });

    $('#selectConsultoras').change(function(){
      $('#primeiraTela').hide();
      $('#segundaTela').show();
    });

    $('#btnEntrar').click(function() {
      
      var txtusuario = $('#txtusuario').val();
      var txtsenha = $('#txtsenha').val();

      if ((txtusuario.length > 0) && (txtsenha.length > 0)) {

        var dados_login = $.grep(arrayUsuarios, function(e){ return ((e.usuario == txtusuario)&&(e.senha == txtsenha))});

        if (dados_login.length > 0) {

          localStorage.dados = JSON.stringify(dados_login[0]);
          location.reload();

        } else {
          alert('senha incorreta!');
        }
      } else {

        alert('Preencha os campos corretamente!');
      }

    });

    var idpessoaSelecionado, posicaoSelecionado;
    $('#arquivoMidia').change(function() {
      
      var $i = $( '#arquivoMidia' ), // Put file input ID here
      input = $i[0]; // Getting the element from jQuery
      if ( input.files && input.files[0] ) {
        file = input.files[0]; // The file
        fr = new FileReader(); // FileReader instance
        fr.onload = function () {
          
          salvaMidia(fr.result);

        };
        //fr.readAsText( file );
        fr.readAsDataURL( file );
      } else {
        alert('selecione uma foto!');
      }

    });

    function sobeFoto(idpessoa, posicao) {
      // console.log({idpessoa,posicao});

      idpessoaSelecionado = idpessoa;
      posicaoSelecionado = posicao;
      $('#arquivoMidia').click();
    }

    function exportar() {
      
      var zip = new JSZip();
      
      for (var i in arrayPessoas) {
        var e = arrayPessoas[i];
        var idpessoa = e.idpessoa;
        var nome = e.nome;
        var foto1 = retornaMidias(idpessoa, 1);
        if (typeof foto1 != 'undefined') {

          var tipoFoto1 = foto1.split(';')[0].split('/')[1];
          foto1 = foto1.split(',')[1];
        }

        var foto2 = retornaMidias(idpessoa, 2);
        if (typeof foto2 != 'undefined') {

          var tipoFoto2 = foto2.split(';')[0].split('/')[1];
          foto2 = foto2.split(',')[1];
        }

        var foto3 = retornaMidias(idpessoa, 3);
        if (typeof foto3 != 'undefined') {

          var tipoFoto3 = foto3.split(';')[0].split('/')[1];
          foto3 = foto3.split(',')[1];
        }

        var video = retornaMidias(idpessoa, 4);

        if (typeof video != 'undefined') {

          var img = zip.folder(nome);
          
          img.file("midia1."+tipoFoto1, foto1,{base64: true});
          img.file("midia2."+tipoFoto2, foto2,{base64: true});
          img.file("midia3."+tipoFoto3, foto3,{base64: true});
          img.file("video.webm", video,{base64: true});
        }
      }

      zip.generateAsync({type:"blob"})
      .then(function(content) {
        var hoje = new Date();
        saveAs(content, dados.usuario+"_"+dados.idempresa+"_"+hoje.getTime()+".zip");
      });
    }

    function aumentar(idpessoa, posicao, tipo) {
      
      fecharModal();
      var modal = '<div id="modalAumentar">';
        modal += '<a onclick="fecharModal()">X</a>';

        if (tipo == 1) {

          modal += '<img src="'+retornaMidias(idpessoa, posicao)+'">';
        } else if (tipo == 2) {
          modal += '<video src="'+retornaMidias(idpessoa, posicao)+'" style="display:inherit;position: inherit;width:inherit;" autoplay muted loop></video>';
        } else if (tipo == 3) {
          modal += '<video src="data:video/webm;base64,'+retornaMidias(idpessoa, posicao)+'" style="display:inherit;position: inherit;width:inherit;" autoplay muted loop></video>';
        }
      modal += '</div>';

      $('body').append(modal);
      $('#modalAumentar').css('width', $(window).width().toString()+'px');
      $('#modalAumentar').css('height', $(window).height().toString()+'px');
    }

    function fecharModal() {
      
      $('#modalAumentar').remove();
    }

    function voltar() {
      if (telaAtual == 'slide') {
        jogar(idpessoaSelecionado);
        $('#recebeTotal').show();
        $('#textoJogo').html('Para jogar clique em um quadrado do quadro abaixo e veja se encontra o <span style="color:#ff5b56;">❤</span> escondido!');
        $('#btn-stop-recording').hide();
        $('#recebeTotal').html('Tentativas: 0');
      } else if (telaAtual == 'jogo') {
        $('#botaoVoltar').hide();
        $('#telaCadastro').show();
        $('#segundaTela').hide();
        $('#div_jogo').hide();
        $('#div_fotos').hide();

        boolPlay = false;
        recorder.destroy();

        $('#telaCadastro').show();
        $('#div_fotos').hide();
        $('#segundaTela').hide();
        musica.pause();
        musica.currentTime = 0;
        boolCadastro = true;
        $('#recebeTotal').show();
        $('#textoJogo').html('Para jogar clique em um quadrado do quadro abaixo e veja se encontra o <span style="color:#ff5b56;">❤</span> escondido!');
        $('#btn-stop-recording').hide();
        $('#recebeTotal').html('Tentativas: 0');
        $('#div_fotos').find('div').html('');
      } 
    }
  </script>
</body>
</html>

